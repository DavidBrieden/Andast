(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var App = {};

App.init = function () {
    this.canvas = document.getElementById("canvas");
    this.canvas.width = 800;
    this.canvas.height = 600;
    this.ctx = this.canvas.getContext("2d");
};

module.exports = App;

},{}],2:[function(require,module,exports){
"use strict";

var boxes = [];

// X
//XXX
boxes.push([{ x: -1, y: 0 }, { x: 0, y: 0 }, { x: 1, y: 0 }, { x: 0, y: 1 }]);
//XX
// XX
boxes.push([{ x: -1, y: 1 }, { x: 0, y: 1 }, { x: 0, y: 0 }, { x: 1, y: 0 }]);
//XX
//XX
boxes.push([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 0 }, { x: 1, y: 1 }]);
//X
//X
//X
//X
boxes.push([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: 2 }, { x: 0, y: -1 }]);
//X
//X
//XX
boxes.push([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: -1 }, { x: -1, y: -1 }]);
// XX
//XX
boxes.push([{ x: -1, y: 0 }, { x: 0, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 1 }]);

module.exports = boxes;

},{}],3:[function(require,module,exports){
"use strict";

var App = require("./App.js");

var Field = {};

Field.init = function () {

    Field.offsetx = 20;
    Field.offsety = 20;
    Field.blocksize = 10;
    Field.width = 20;
    Field.height = 40;

    Field.field = [];
    for (var x = 0; x < Field.width; x++) {
        var column = [];
        for (var y = 0; y < Field.height; y++) {
            column.push({
                show: false,
                color: 0
            });
        }
        Field.field.push(column);
    }
};

Field.render = function () {
    for (var x = 0; x < Field.width; x++) {
        for (var y = 0; y < Field.height; y++) {
            if (Field.field[x][y].show == true) {
                App.ctx.beginPath();
                App.ctx.lineWidth = "3";
                App.ctx.strokeStyle = Field.field[x][y].color;

                App.ctx.rect(x * Field.blocksize + Field.offsetx, (Field.height - 1) * Field.blocksize + Field.offsety - y * Field.blocksize, Field.blocksize, Field.blocksize);
                App.ctx.stroke();
            }
        }
    }

    App.ctx.beginPath();
    App.ctx.lineWidth = "1";
    App.ctx.strokeStyle = "black";
    App.ctx.rect(Field.offsetx, Field.offsety, Field.width * Field.blocksize, Field.height * Field.blocksize);
    App.ctx.stroke();
};

module.exports = Field;

},{"./App.js":1}],4:[function(require,module,exports){
'use strict';

var Field = require('./Field.js');
var App = require('./App.js');
var Boxes = require('./Boxes.js');
var Game = {};

Game.player = {};

Game.start = function () {
    setInterval(this.tick, 50);
    setInterval(function () {
        Game.movePlayer(0, -1);
    }, 1000);
    document.addEventListener("keydown", function (e) {
        if (e.keyCode == '40') {
            // down arrow
            Game.movePlayer(0, -1);
        } else if (e.keyCode == '37') {
            // left arrow
            Game.movePlayer(-1, 0);
        } else if (e.keyCode == '39') {
            // right arrow
            Game.movePlayer(1, 0);
        } else if (e.keyCode == '38') {
            // up arrow
            // Game.movePlayer(0,1);
            Game.spawn();
        } else if (e.keyCode == '32') {
            // press space to flip boxes
            e.preventDefault();
            for (var i = 0; i < 4; i++) {
                // Koordinate im Spielfeld setzen
                Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
                    show: false,
                    color: "green"
                };
            }
            // var flip = Array.from(Game.player.figure);
            var flip1 = Game.player.figure[0];
            var flip2 = Game.player.figure[1];
            var flip3 = Game.player.figure[2];
            var flip4 = Game.player.figure[3];

            Game.player.figure[0] = { x: 0 - flip1.y, y: flip1.x };
            Game.player.figure[1] = { x: 0 - flip2.y, y: flip2.x };
            Game.player.figure[2] = { x: 0 - flip3.y, y: flip3.x };
            Game.player.figure[3] = { x: 0 - flip4.y, y: flip4.x };

            /*for (var i = 0; i<4;i++){
                flip[i].x = 1 - Game.player.figure[i].y;
                flip[i].y = Game.player.figure[i].x;
            }*/
            //Game.player.figure = flip;
            Game.movePlayer(0, 0);
        }
    });
};

Game.tick = function () {
    Game.update();
    Game.render();
};

Game.render = function () {
    App.ctx.clearRect(0, 0, App.canvas.width, App.canvas.height);
    Field.render();
};

Game.update = function () {};

Game.spawn = function () {
    var spawnpoint = { x: Math.floor(Field.width / 2) - 1, y: Field.height - 1 };
    Game.player.position = spawnpoint;
    // eine zufällige Figur auswählen
    var index = Math.floor(Math.random() * Boxes.length);
    var figure = Boxes[index];
    Game.player.figure = figure;

    var r = Math.floor(Math.random() * 256);
    var g = Math.floor(Math.random() * 256);
    var b = Math.floor(Math.random() * 256);

    Game.player.color = 'rgb(' + r + ',' + g + ',' + b + ')';

    // Jede Koordinate der gewählten Figur iterieren
    for (var i = 0; i < 4; i++) {
        // Koordinate im Spielfeld setzen
        Field.field[spawnpoint.x - figure[i].x][spawnpoint.y - figure[i].y] = {
            show: true,
            color: Game.player.color
        };
    }
};

Game.movePlayer = function (x, y) {

    //Test if box would be still in field
    for (var i = 0; i < 4; i++) {
        if (Game.player.position.x - Game.player.figure[i].x + x < 0 || Game.player.position.x - Game.player.figure[i].x + x >= Field.width) {
            x = 0;
        } else if (Game.player.position.y - Game.player.figure[i].y + y < 0) {
            Game.spawn();
            return;
        }
    }
    // Jede Koordinate der gewählten Figur iterieren
    for (var i = 0; i < 4; i++) {
        // Koordinate im Spielfeld setzen
        Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
            show: false,
            color: "green"
        };
    }

    //Test if box would collide with other boxes
    for (var i = 0; i < 4; i++) {
        if (Field.field[Game.player.position.x - Game.player.figure[i].x + x][Game.player.position.y - Game.player.figure[i].y + y].show == true) {
            this.x = 0;
            this.y = 0;
            for (var j = 0; j < 4; j++) {
                Field.field[Game.player.position.x - Game.player.figure[j].x][Game.player.position.y - Game.player.figure[j].y] = {
                    show: true,
                    color: Game.player.color
                };
            }
            Game.spawn();
            return;
        }
    }

    Game.player.position.y += y;
    Game.player.position.x += x;
    // Jede Koordinate der gewählten Figur iterieren
    // Koordinate im Spielfeld setzen
    for (var i = 0; i < 4; i++) {
        Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
            show: true,
            color: Game.player.color
        };
    }
};

module.exports = Game;

},{"./App.js":1,"./Boxes.js":2,"./Field.js":3}],5:[function(require,module,exports){
'use strict';

var Game = require('./Game.js');
var App = require('./App.js');
var Field = require('./Field.js');

App.init();
Field.init();

Game.spawn();

Game.start();

},{"./App.js":1,"./Field.js":3,"./Game.js":4}]},{},[5])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmNcXGNsaWVudFxcc2NyaXB0c1xcQXBwLmpzIiwic3JjXFxjbGllbnRcXHNjcmlwdHNcXEJveGVzLmpzIiwic3JjXFxjbGllbnRcXHNjcmlwdHNcXEZpZWxkLmpzIiwic3JjXFxjbGllbnRcXHNjcmlwdHNcXEdhbWUuanMiLCJzcmNcXGNsaWVudFxcc2NyaXB0c1xcbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBSSxNQUFNLEVBQVY7O0FBRUEsSUFBSSxJQUFKLEdBQVcsWUFBVTtBQUNqQixTQUFLLE1BQUwsR0FBYyxTQUFTLGNBQVQsQ0FBd0IsUUFBeEIsQ0FBZDtBQUNBLFNBQUssTUFBTCxDQUFZLEtBQVosR0FBb0IsR0FBcEI7QUFDQSxTQUFLLE1BQUwsQ0FBWSxNQUFaLEdBQXFCLEdBQXJCO0FBQ0EsU0FBSyxHQUFMLEdBQVcsS0FBSyxNQUFMLENBQVksVUFBWixDQUF1QixJQUF2QixDQUFYO0FBQ0gsQ0FMRDs7QUFPQSxPQUFPLE9BQVAsR0FBaUIsR0FBakI7Ozs7O0FDVEEsSUFBSSxRQUFRLEVBQVo7O0FBRUE7QUFDQTtBQUNBLE1BQU0sSUFBTixDQUFXLENBQUMsRUFBQyxHQUFFLENBQUMsQ0FBSixFQUFNLEdBQUUsQ0FBUixFQUFELEVBQVksRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBWixFQUFzQixFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUF0QixFQUFnQyxFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUFoQyxDQUFYO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBTixDQUFXLENBQUMsRUFBQyxHQUFFLENBQUMsQ0FBSixFQUFNLEdBQUUsQ0FBUixFQUFELEVBQVksRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBWixFQUFzQixFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUF0QixFQUFnQyxFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUFoQyxDQUFYO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBTixDQUFXLENBQUMsRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBRCxFQUFXLEVBQUMsR0FBRSxDQUFILEVBQUssR0FBRSxDQUFQLEVBQVgsRUFBcUIsRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBckIsRUFBK0IsRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBL0IsQ0FBWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSxJQUFOLENBQVcsQ0FBQyxFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUFELEVBQVcsRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBWCxFQUFxQixFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUFyQixFQUErQixFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBQyxDQUFSLEVBQS9CLENBQVg7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLElBQU4sQ0FBVyxDQUFDLEVBQUMsR0FBRSxDQUFILEVBQUssR0FBRSxDQUFQLEVBQUQsRUFBVyxFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUFYLEVBQXFCLEVBQUMsR0FBRSxDQUFILEVBQUssR0FBRSxDQUFDLENBQVIsRUFBckIsRUFBZ0MsRUFBQyxHQUFFLENBQUMsQ0FBSixFQUFNLEdBQUUsQ0FBQyxDQUFULEVBQWhDLENBQVg7QUFDQTtBQUNBO0FBQ0EsTUFBTSxJQUFOLENBQVcsQ0FBQyxFQUFDLEdBQUUsQ0FBQyxDQUFKLEVBQU0sR0FBRSxDQUFSLEVBQUQsRUFBWSxFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUFaLEVBQXNCLEVBQUMsR0FBRSxDQUFILEVBQUssR0FBRSxDQUFQLEVBQXRCLEVBQWdDLEVBQUMsR0FBRSxDQUFILEVBQUssR0FBRSxDQUFQLEVBQWhDLENBQVg7O0FBRUEsT0FBTyxPQUFQLEdBQWlCLEtBQWpCOzs7OztBQ3hCQSxJQUFJLE1BQU0sUUFBUSxVQUFSLENBQVY7O0FBR0EsSUFBSSxRQUFRLEVBQVo7O0FBRUEsTUFBTSxJQUFOLEdBQWEsWUFBVTs7QUFFbkIsVUFBTSxPQUFOLEdBQWdCLEVBQWhCO0FBQ0EsVUFBTSxPQUFOLEdBQWdCLEVBQWhCO0FBQ0EsVUFBTSxTQUFOLEdBQWtCLEVBQWxCO0FBQ0EsVUFBTSxLQUFOLEdBQWMsRUFBZDtBQUNBLFVBQU0sTUFBTixHQUFlLEVBQWY7O0FBRUEsVUFBTSxLQUFOLEdBQWMsRUFBZDtBQUNBLFNBQUksSUFBSSxJQUFFLENBQVYsRUFBWSxJQUFFLE1BQU0sS0FBcEIsRUFBMEIsR0FBMUIsRUFBOEI7QUFDMUIsWUFBSSxTQUFTLEVBQWI7QUFDQSxhQUFJLElBQUksSUFBRSxDQUFWLEVBQVksSUFBRSxNQUFNLE1BQXBCLEVBQTJCLEdBQTNCLEVBQStCO0FBQzNCLG1CQUFPLElBQVAsQ0FBWTtBQUNSLHNCQUFNLEtBREU7QUFFUix1QkFBTztBQUZDLGFBQVo7QUFJSDtBQUNELGNBQU0sS0FBTixDQUFZLElBQVosQ0FBaUIsTUFBakI7QUFDSDtBQUdKLENBckJEOztBQXdCQSxNQUFNLE1BQU4sR0FBZSxZQUFVO0FBQ3JCLFNBQUksSUFBSSxJQUFFLENBQVYsRUFBWSxJQUFFLE1BQU0sS0FBcEIsRUFBMEIsR0FBMUIsRUFBOEI7QUFDMUIsYUFBSSxJQUFJLElBQUUsQ0FBVixFQUFZLElBQUUsTUFBTSxNQUFwQixFQUEyQixHQUEzQixFQUErQjtBQUMzQixnQkFBSSxNQUFNLEtBQU4sQ0FBWSxDQUFaLEVBQWUsQ0FBZixFQUFrQixJQUFsQixJQUEwQixJQUE5QixFQUFvQztBQUNoQyxvQkFBSSxHQUFKLENBQVEsU0FBUjtBQUNBLG9CQUFJLEdBQUosQ0FBUSxTQUFSLEdBQWtCLEdBQWxCO0FBQ0Esb0JBQUksR0FBSixDQUFRLFdBQVIsR0FBc0IsTUFBTSxLQUFOLENBQVksQ0FBWixFQUFlLENBQWYsRUFBa0IsS0FBeEM7O0FBRUEsb0JBQUksR0FBSixDQUFRLElBQVIsQ0FDSSxJQUFFLE1BQU0sU0FBUixHQUFrQixNQUFNLE9BRDVCLEVBRUssQ0FBQyxNQUFNLE1BQU4sR0FBYSxDQUFkLElBQWlCLE1BQU0sU0FBeEIsR0FBbUMsTUFBTSxPQUF6QyxHQUFrRCxJQUFFLE1BQU0sU0FGOUQsRUFHSSxNQUFNLFNBSFYsRUFJSSxNQUFNLFNBSlY7QUFNQSxvQkFBSSxHQUFKLENBQVEsTUFBUjtBQUNIO0FBQ0o7QUFDSjs7QUFFRCxRQUFJLEdBQUosQ0FBUSxTQUFSO0FBQ0EsUUFBSSxHQUFKLENBQVEsU0FBUixHQUFrQixHQUFsQjtBQUNBLFFBQUksR0FBSixDQUFRLFdBQVIsR0FBc0IsT0FBdEI7QUFDQSxRQUFJLEdBQUosQ0FBUSxJQUFSLENBQ0ksTUFBTSxPQURWLEVBRUksTUFBTSxPQUZWLEVBR0ksTUFBTSxLQUFOLEdBQVksTUFBTSxTQUh0QixFQUlJLE1BQU0sTUFBTixHQUFlLE1BQU0sU0FKekI7QUFNQSxRQUFJLEdBQUosQ0FBUSxNQUFSO0FBQ0gsQ0E3QkQ7O0FBaUNBLE9BQU8sT0FBUCxHQUFpQixLQUFqQjs7Ozs7QUM5REEsSUFBSSxRQUFRLFFBQVEsWUFBUixDQUFaO0FBQ0EsSUFBSSxNQUFNLFFBQVEsVUFBUixDQUFWO0FBQ0EsSUFBSSxRQUFRLFFBQVEsWUFBUixDQUFaO0FBQ0EsSUFBSSxPQUFPLEVBQVg7O0FBRUEsS0FBSyxNQUFMLEdBQWMsRUFBZDs7QUFFQSxLQUFLLEtBQUwsR0FBYSxZQUFVO0FBQ25CLGdCQUFZLEtBQUssSUFBakIsRUFBdUIsRUFBdkI7QUFDQSxnQkFBWSxZQUFVO0FBQUMsYUFBSyxVQUFMLENBQWdCLENBQWhCLEVBQWtCLENBQUMsQ0FBbkI7QUFBc0IsS0FBN0MsRUFBK0MsSUFBL0M7QUFDQSxhQUFTLGdCQUFULENBQTBCLFNBQTFCLEVBQXFDLFVBQVMsQ0FBVCxFQUFXO0FBQzVDLFlBQUksRUFBRSxPQUFGLElBQWEsSUFBakIsRUFBdUI7QUFDbkI7QUFDQSxpQkFBSyxVQUFMLENBQWdCLENBQWhCLEVBQWtCLENBQUMsQ0FBbkI7QUFDSCxTQUhELE1BSUssSUFBSSxFQUFFLE9BQUYsSUFBYSxJQUFqQixFQUF1QjtBQUN4QjtBQUNBLGlCQUFLLFVBQUwsQ0FBZ0IsQ0FBQyxDQUFqQixFQUFtQixDQUFuQjtBQUNILFNBSEksTUFJQSxJQUFJLEVBQUUsT0FBRixJQUFhLElBQWpCLEVBQXVCO0FBQ3hCO0FBQ0EsaUJBQUssVUFBTCxDQUFnQixDQUFoQixFQUFrQixDQUFsQjtBQUNILFNBSEksTUFJQSxJQUFJLEVBQUUsT0FBRixJQUFhLElBQWpCLEVBQXVCO0FBQ3hCO0FBQ0E7QUFDQSxpQkFBSyxLQUFMO0FBQ0gsU0FKSSxNQUlDLElBQUksRUFBRSxPQUFGLElBQWEsSUFBakIsRUFBdUI7QUFDekI7QUFDQSxjQUFFLGNBQUY7QUFDQSxpQkFBSyxJQUFJLElBQUUsQ0FBWCxFQUFhLElBQUUsQ0FBZixFQUFpQixHQUFqQixFQUFxQjtBQUNqQjtBQUNBLHNCQUFNLEtBQU4sQ0FBWSxLQUFLLE1BQUwsQ0FBWSxRQUFaLENBQXFCLENBQXJCLEdBQXlCLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsRUFBc0IsQ0FBM0QsRUFBOEQsS0FBSyxNQUFMLENBQVksUUFBWixDQUFxQixDQUFyQixHQUF5QixLQUFLLE1BQUwsQ0FBWSxNQUFaLENBQW1CLENBQW5CLEVBQXNCLENBQTdHLElBQWtIO0FBQ2xILDBCQUFNLEtBRDRHO0FBRWxILDJCQUFPO0FBRjJHLGlCQUFsSDtBQUlYO0FBQ087QUFDQSxnQkFBSSxRQUFRLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsQ0FBWjtBQUNBLGdCQUFJLFFBQVEsS0FBSyxNQUFMLENBQVksTUFBWixDQUFtQixDQUFuQixDQUFaO0FBQ0EsZ0JBQUksUUFBUSxLQUFLLE1BQUwsQ0FBWSxNQUFaLENBQW1CLENBQW5CLENBQVo7QUFDQSxnQkFBSSxRQUFRLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsQ0FBWjs7QUFFQSxpQkFBSyxNQUFMLENBQVksTUFBWixDQUFtQixDQUFuQixJQUFzQixFQUFDLEdBQUUsSUFBRSxNQUFNLENBQVgsRUFBYSxHQUFFLE1BQU0sQ0FBckIsRUFBdEI7QUFDQSxpQkFBSyxNQUFMLENBQVksTUFBWixDQUFtQixDQUFuQixJQUFzQixFQUFDLEdBQUUsSUFBRSxNQUFNLENBQVgsRUFBYSxHQUFFLE1BQU0sQ0FBckIsRUFBdEI7QUFDQSxpQkFBSyxNQUFMLENBQVksTUFBWixDQUFtQixDQUFuQixJQUFzQixFQUFDLEdBQUUsSUFBRSxNQUFNLENBQVgsRUFBYSxHQUFFLE1BQU0sQ0FBckIsRUFBdEI7QUFDQSxpQkFBSyxNQUFMLENBQVksTUFBWixDQUFtQixDQUFuQixJQUFzQixFQUFDLEdBQUUsSUFBRSxNQUFNLENBQVgsRUFBYSxHQUFFLE1BQU0sQ0FBckIsRUFBdEI7O0FBRUE7Ozs7QUFJQTtBQUNBLGlCQUFLLFVBQUwsQ0FBZ0IsQ0FBaEIsRUFBa0IsQ0FBbEI7QUFDSDtBQUNKLEtBN0NEO0FBK0NILENBbEREOztBQW9EQSxLQUFLLElBQUwsR0FBWSxZQUFVO0FBQ2xCLFNBQUssTUFBTDtBQUNBLFNBQUssTUFBTDtBQUNILENBSEQ7O0FBS0EsS0FBSyxNQUFMLEdBQWMsWUFBVTtBQUNwQixRQUFJLEdBQUosQ0FBUSxTQUFSLENBQWtCLENBQWxCLEVBQXFCLENBQXJCLEVBQXdCLElBQUksTUFBSixDQUFXLEtBQW5DLEVBQTBDLElBQUksTUFBSixDQUFXLE1BQXJEO0FBQ0EsVUFBTSxNQUFOO0FBQ0gsQ0FIRDs7QUFLQSxLQUFLLE1BQUwsR0FBYyxZQUFVLENBRXZCLENBRkQ7O0FBSUEsS0FBSyxLQUFMLEdBQWEsWUFBVTtBQUNuQixRQUFJLGFBQWEsRUFBQyxHQUFHLEtBQUssS0FBTCxDQUFXLE1BQU0sS0FBTixHQUFZLENBQXZCLElBQTBCLENBQTlCLEVBQWdDLEdBQUUsTUFBTSxNQUFOLEdBQWEsQ0FBL0MsRUFBakI7QUFDQSxTQUFLLE1BQUwsQ0FBWSxRQUFaLEdBQXVCLFVBQXZCO0FBQ0E7QUFDQSxRQUFJLFFBQVEsS0FBSyxLQUFMLENBQVcsS0FBSyxNQUFMLEtBQWlCLE1BQU0sTUFBbEMsQ0FBWjtBQUNBLFFBQUksU0FBUyxNQUFNLEtBQU4sQ0FBYjtBQUNBLFNBQUssTUFBTCxDQUFZLE1BQVosR0FBcUIsTUFBckI7O0FBRUEsUUFBSSxJQUFJLEtBQUssS0FBTCxDQUFXLEtBQUssTUFBTCxLQUFjLEdBQXpCLENBQVI7QUFDQSxRQUFJLElBQUksS0FBSyxLQUFMLENBQVcsS0FBSyxNQUFMLEtBQWMsR0FBekIsQ0FBUjtBQUNBLFFBQUksSUFBSSxLQUFLLEtBQUwsQ0FBVyxLQUFLLE1BQUwsS0FBYyxHQUF6QixDQUFSOztBQUVBLFNBQUssTUFBTCxDQUFZLEtBQVosR0FBb0IsU0FBTyxDQUFQLEdBQVMsR0FBVCxHQUFhLENBQWIsR0FBZSxHQUFmLEdBQW1CLENBQW5CLEdBQXFCLEdBQXpDOztBQUVBO0FBQ0EsU0FBSyxJQUFJLElBQUUsQ0FBWCxFQUFhLElBQUUsQ0FBZixFQUFpQixHQUFqQixFQUFxQjtBQUNqQjtBQUNBLGNBQU0sS0FBTixDQUFZLFdBQVcsQ0FBWCxHQUFlLE9BQU8sQ0FBUCxFQUFVLENBQXJDLEVBQXdDLFdBQVcsQ0FBWCxHQUFlLE9BQU8sQ0FBUCxFQUFVLENBQWpFLElBQXNFO0FBQ2xFLGtCQUFNLElBRDREO0FBRWxFLG1CQUFPLEtBQUssTUFBTCxDQUFZO0FBRitDLFNBQXRFO0FBSUg7QUFDSixDQXRCRDs7QUF5QkEsS0FBSyxVQUFMLEdBQWtCLFVBQVMsQ0FBVCxFQUFXLENBQVgsRUFBYTs7QUFFM0I7QUFDQSxTQUFLLElBQUksSUFBRSxDQUFYLEVBQWEsSUFBRSxDQUFmLEVBQWlCLEdBQWpCLEVBQXFCO0FBQ2pCLFlBQUksS0FBSyxNQUFMLENBQVksUUFBWixDQUFxQixDQUFyQixHQUF5QixLQUFLLE1BQUwsQ0FBWSxNQUFaLENBQW1CLENBQW5CLEVBQXNCLENBQS9DLEdBQW1ELENBQW5ELEdBQXVELENBQXZELElBQTRELEtBQUssTUFBTCxDQUFZLFFBQVosQ0FBcUIsQ0FBckIsR0FBeUIsS0FBSyxNQUFMLENBQVksTUFBWixDQUFtQixDQUFuQixFQUFzQixDQUEvQyxHQUFtRCxDQUFuRCxJQUF3RCxNQUFNLEtBQTlILEVBQW9JO0FBQ2hJLGdCQUFJLENBQUo7QUFDSCxTQUZELE1BRU8sSUFBSSxLQUFLLE1BQUwsQ0FBWSxRQUFaLENBQXFCLENBQXJCLEdBQXlCLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsRUFBc0IsQ0FBL0MsR0FBbUQsQ0FBbkQsR0FBdUQsQ0FBM0QsRUFBNkQ7QUFDaEUsaUJBQUssS0FBTDtBQUNBO0FBQ0g7QUFFSjtBQUNEO0FBQ0EsU0FBSyxJQUFJLElBQUUsQ0FBWCxFQUFhLElBQUUsQ0FBZixFQUFpQixHQUFqQixFQUFxQjtBQUNqQjtBQUNBLGNBQU0sS0FBTixDQUFZLEtBQUssTUFBTCxDQUFZLFFBQVosQ0FBcUIsQ0FBckIsR0FBeUIsS0FBSyxNQUFMLENBQVksTUFBWixDQUFtQixDQUFuQixFQUFzQixDQUEzRCxFQUE4RCxLQUFLLE1BQUwsQ0FBWSxRQUFaLENBQXFCLENBQXJCLEdBQXlCLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsRUFBc0IsQ0FBN0csSUFBa0g7QUFDOUcsa0JBQU0sS0FEd0c7QUFFOUcsbUJBQU87QUFGdUcsU0FBbEg7QUFJSDs7QUFFRDtBQUNBLFNBQUssSUFBSSxJQUFFLENBQVgsRUFBYSxJQUFFLENBQWYsRUFBaUIsR0FBakIsRUFBcUI7QUFDakIsWUFBSyxNQUFNLEtBQU4sQ0FBWSxLQUFLLE1BQUwsQ0FBWSxRQUFaLENBQXFCLENBQXJCLEdBQXlCLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsRUFBc0IsQ0FBL0MsR0FBaUQsQ0FBN0QsRUFBZ0UsS0FBSyxNQUFMLENBQVksUUFBWixDQUFxQixDQUFyQixHQUF5QixLQUFLLE1BQUwsQ0FBWSxNQUFaLENBQW1CLENBQW5CLEVBQXNCLENBQS9DLEdBQWlELENBQWpILEVBQW9ILElBQXBILElBQTRILElBQWpJLEVBQXNJO0FBQ2xJLGlCQUFLLENBQUwsR0FBTyxDQUFQO0FBQ0EsaUJBQUssQ0FBTCxHQUFPLENBQVA7QUFDQSxpQkFBSyxJQUFJLElBQUUsQ0FBWCxFQUFhLElBQUUsQ0FBZixFQUFpQixHQUFqQixFQUFxQjtBQUNqQixzQkFBTSxLQUFOLENBQVksS0FBSyxNQUFMLENBQVksUUFBWixDQUFxQixDQUFyQixHQUF5QixLQUFLLE1BQUwsQ0FBWSxNQUFaLENBQW1CLENBQW5CLEVBQXNCLENBQTNELEVBQThELEtBQUssTUFBTCxDQUFZLFFBQVosQ0FBcUIsQ0FBckIsR0FBeUIsS0FBSyxNQUFMLENBQVksTUFBWixDQUFtQixDQUFuQixFQUFzQixDQUE3RyxJQUFrSDtBQUM5RywwQkFBTSxJQUR3RztBQUU5RywyQkFBTyxLQUFLLE1BQUwsQ0FBWTtBQUYyRixpQkFBbEg7QUFJSDtBQUNELGlCQUFLLEtBQUw7QUFDQTtBQUNIO0FBQ0o7O0FBRUQsU0FBSyxNQUFMLENBQVksUUFBWixDQUFxQixDQUFyQixJQUF3QixDQUF4QjtBQUNBLFNBQUssTUFBTCxDQUFZLFFBQVosQ0FBcUIsQ0FBckIsSUFBd0IsQ0FBeEI7QUFDQTtBQUNBO0FBQ0EsU0FBSyxJQUFJLElBQUUsQ0FBWCxFQUFhLElBQUUsQ0FBZixFQUFpQixHQUFqQixFQUFxQjtBQUNqQixjQUFNLEtBQU4sQ0FBWSxLQUFLLE1BQUwsQ0FBWSxRQUFaLENBQXFCLENBQXJCLEdBQXlCLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsRUFBc0IsQ0FBM0QsRUFBOEQsS0FBSyxNQUFMLENBQVksUUFBWixDQUFxQixDQUFyQixHQUF5QixLQUFLLE1BQUwsQ0FBWSxNQUFaLENBQW1CLENBQW5CLEVBQXNCLENBQTdHLElBQWtIO0FBQzlHLGtCQUFNLElBRHdHO0FBRTlHLG1CQUFPLEtBQUssTUFBTCxDQUFZO0FBRjJGLFNBQWxIO0FBSUg7QUFDSixDQS9DRDs7QUFpREEsT0FBTyxPQUFQLEdBQWlCLElBQWpCOzs7OztBQ25KQSxJQUFJLE9BQU8sUUFBUSxXQUFSLENBQVg7QUFDQSxJQUFJLE1BQU0sUUFBUSxVQUFSLENBQVY7QUFDQSxJQUFJLFFBQVEsUUFBUSxZQUFSLENBQVo7O0FBRUEsSUFBSSxJQUFKO0FBQ0EsTUFBTSxJQUFOOztBQUVBLEtBQUssS0FBTDs7QUFFQSxLQUFLLEtBQUwiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIEFwcCA9IHt9O1xyXG5cclxuQXBwLmluaXQgPSBmdW5jdGlvbigpe1xyXG4gICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbnZhc1wiKTtcclxuICAgIHRoaXMuY2FudmFzLndpZHRoID0gODAwO1xyXG4gICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gNjAwO1xyXG4gICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEFwcDsiLCJ2YXIgYm94ZXMgPSBbXTtcclxuXHJcbi8vIFhcclxuLy9YWFhcclxuYm94ZXMucHVzaChbe3g6LTEseTowfSx7eDowLHk6MH0se3g6MSx5OjB9LHt4OjAseToxfV0pO1xyXG4vL1hYXHJcbi8vIFhYXHJcbmJveGVzLnB1c2goW3t4Oi0xLHk6MX0se3g6MCx5OjF9LHt4OjAseTowfSx7eDoxLHk6MH1dKTtcclxuLy9YWFxyXG4vL1hYXHJcbmJveGVzLnB1c2goW3t4OjAseTowfSx7eDowLHk6MX0se3g6MSx5OjB9LHt4OjEseToxfV0pO1xyXG4vL1hcclxuLy9YXHJcbi8vWFxyXG4vL1hcclxuYm94ZXMucHVzaChbe3g6MCx5OjB9LHt4OjAseToxfSx7eDowLHk6Mn0se3g6MCx5Oi0xfV0pO1xyXG4vL1hcclxuLy9YXHJcbi8vWFhcclxuYm94ZXMucHVzaChbe3g6MCx5OjB9LHt4OjAseToxfSx7eDowLHk6LTF9LHt4Oi0xLHk6LTF9XSk7XHJcbi8vIFhYXHJcbi8vWFhcclxuYm94ZXMucHVzaChbe3g6LTEseTowfSx7eDowLHk6MH0se3g6MCx5OjF9LHt4OjEseToxfV0pO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBib3hlcztcclxuIiwidmFyIEFwcCA9IHJlcXVpcmUoXCIuL0FwcC5qc1wiKTtcclxuXHJcblxyXG52YXIgRmllbGQgPSB7fTtcclxuXHJcbkZpZWxkLmluaXQgPSBmdW5jdGlvbigpe1xyXG5cclxuICAgIEZpZWxkLm9mZnNldHggPSAyMDtcclxuICAgIEZpZWxkLm9mZnNldHkgPSAyMDtcclxuICAgIEZpZWxkLmJsb2Nrc2l6ZSA9IDEwO1xyXG4gICAgRmllbGQud2lkdGggPSAyMDtcclxuICAgIEZpZWxkLmhlaWdodCA9IDQwO1xyXG5cclxuICAgIEZpZWxkLmZpZWxkID0gW107XHJcbiAgICBmb3IodmFyIHg9MDt4PEZpZWxkLndpZHRoO3grKyl7XHJcbiAgICAgICAgdmFyIGNvbHVtbiA9IFtdO1xyXG4gICAgICAgIGZvcih2YXIgeT0wO3k8RmllbGQuaGVpZ2h0O3krKyl7XHJcbiAgICAgICAgICAgIGNvbHVtbi5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHNob3c6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgY29sb3I6IDBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEZpZWxkLmZpZWxkLnB1c2goY29sdW1uKTtcclxuICAgIH1cclxuICAgIFxyXG5cclxufTtcclxuXHJcblxyXG5GaWVsZC5yZW5kZXIgPSBmdW5jdGlvbigpe1xyXG4gICAgZm9yKHZhciB4PTA7eDxGaWVsZC53aWR0aDt4Kyspe1xyXG4gICAgICAgIGZvcih2YXIgeT0wO3k8RmllbGQuaGVpZ2h0O3krKyl7XHJcbiAgICAgICAgICAgIGlmIChGaWVsZC5maWVsZFt4XVt5XS5zaG93ID09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIEFwcC5jdHguYmVnaW5QYXRoKCk7XHJcbiAgICAgICAgICAgICAgICBBcHAuY3R4LmxpbmVXaWR0aD1cIjNcIjtcclxuICAgICAgICAgICAgICAgIEFwcC5jdHguc3Ryb2tlU3R5bGUgPSBGaWVsZC5maWVsZFt4XVt5XS5jb2xvcjtcclxuXHJcbiAgICAgICAgICAgICAgICBBcHAuY3R4LnJlY3QoXHJcbiAgICAgICAgICAgICAgICAgICAgeCpGaWVsZC5ibG9ja3NpemUrRmllbGQub2Zmc2V0eCxcclxuICAgICAgICAgICAgICAgICAgICAoKEZpZWxkLmhlaWdodC0xKSpGaWVsZC5ibG9ja3NpemUpK0ZpZWxkLm9mZnNldHktKHkqRmllbGQuYmxvY2tzaXplKSxcclxuICAgICAgICAgICAgICAgICAgICBGaWVsZC5ibG9ja3NpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgRmllbGQuYmxvY2tzaXplXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgQXBwLmN0eC5zdHJva2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBBcHAuY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgQXBwLmN0eC5saW5lV2lkdGg9XCIxXCI7XHJcbiAgICBBcHAuY3R4LnN0cm9rZVN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgQXBwLmN0eC5yZWN0KFxyXG4gICAgICAgIEZpZWxkLm9mZnNldHgsXHJcbiAgICAgICAgRmllbGQub2Zmc2V0eSxcclxuICAgICAgICBGaWVsZC53aWR0aCpGaWVsZC5ibG9ja3NpemUsXHJcbiAgICAgICAgRmllbGQuaGVpZ2h0ICogRmllbGQuYmxvY2tzaXplXHJcbiAgICApO1xyXG4gICAgQXBwLmN0eC5zdHJva2UoKTtcclxufTtcclxuXHJcblxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBGaWVsZDsiLCJ2YXIgRmllbGQgPSByZXF1aXJlKCcuL0ZpZWxkLmpzJyk7XHJcbnZhciBBcHAgPSByZXF1aXJlKCcuL0FwcC5qcycpO1xyXG52YXIgQm94ZXMgPSByZXF1aXJlKCcuL0JveGVzLmpzJyk7XHJcbnZhciBHYW1lID0ge307XHJcblxyXG5HYW1lLnBsYXllciA9IHt9O1xyXG5cclxuR2FtZS5zdGFydCA9IGZ1bmN0aW9uKCl7XHJcbiAgICBzZXRJbnRlcnZhbCh0aGlzLnRpY2ssIDUwKTtcclxuICAgIHNldEludGVydmFsKGZ1bmN0aW9uKCl7R2FtZS5tb3ZlUGxheWVyKDAsLTEpfSwgMTAwMCk7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbihlKXtcclxuICAgICAgICBpZiAoZS5rZXlDb2RlID09ICc0MCcpIHtcclxuICAgICAgICAgICAgLy8gZG93biBhcnJvd1xyXG4gICAgICAgICAgICBHYW1lLm1vdmVQbGF5ZXIoMCwtMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGUua2V5Q29kZSA9PSAnMzcnKSB7XHJcbiAgICAgICAgICAgIC8vIGxlZnQgYXJyb3dcclxuICAgICAgICAgICAgR2FtZS5tb3ZlUGxheWVyKC0xLDApOyAgICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzM5Jykge1xyXG4gICAgICAgICAgICAvLyByaWdodCBhcnJvd1xyXG4gICAgICAgICAgICBHYW1lLm1vdmVQbGF5ZXIoMSwwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZS5rZXlDb2RlID09ICczOCcpIHtcclxuICAgICAgICAgICAgLy8gdXAgYXJyb3dcclxuICAgICAgICAgICAgLy8gR2FtZS5tb3ZlUGxheWVyKDAsMSk7XHJcbiAgICAgICAgICAgIEdhbWUuc3Bhd24oKTtcclxuICAgICAgICB9ZWxzZSBpZiAoZS5rZXlDb2RlID09ICczMicpIHtcclxuICAgICAgICAgICAgLy8gcHJlc3Mgc3BhY2UgdG8gZmxpcCBib3hlc1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPDQ7aSsrKXtcclxuICAgICAgICAgICAgICAgIC8vIEtvb3JkaW5hdGUgaW0gU3BpZWxmZWxkIHNldHplblxyXG4gICAgICAgICAgICAgICAgRmllbGQuZmllbGRbR2FtZS5wbGF5ZXIucG9zaXRpb24ueCAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS54XVtHYW1lLnBsYXllci5wb3NpdGlvbi55IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLnldID0ge1xyXG4gICAgICAgICAgICAgICAgc2hvdzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjogXCJncmVlblwiXHJcbiAgICAgICAgICAgIH07XHJcbiAgICB9ICBcclxuICAgICAgICAgICAgLy8gdmFyIGZsaXAgPSBBcnJheS5mcm9tKEdhbWUucGxheWVyLmZpZ3VyZSk7XHJcbiAgICAgICAgICAgIHZhciBmbGlwMSA9IEdhbWUucGxheWVyLmZpZ3VyZVswXTtcclxuICAgICAgICAgICAgdmFyIGZsaXAyID0gR2FtZS5wbGF5ZXIuZmlndXJlWzFdO1xyXG4gICAgICAgICAgICB2YXIgZmxpcDMgPSBHYW1lLnBsYXllci5maWd1cmVbMl07XHJcbiAgICAgICAgICAgIHZhciBmbGlwNCA9IEdhbWUucGxheWVyLmZpZ3VyZVszXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIEdhbWUucGxheWVyLmZpZ3VyZVswXT17eDowLWZsaXAxLnkseTpmbGlwMS54fTtcclxuICAgICAgICAgICAgR2FtZS5wbGF5ZXIuZmlndXJlWzFdPXt4OjAtZmxpcDIueSx5OmZsaXAyLnh9O1xyXG4gICAgICAgICAgICBHYW1lLnBsYXllci5maWd1cmVbMl09e3g6MC1mbGlwMy55LHk6ZmxpcDMueH07XHJcbiAgICAgICAgICAgIEdhbWUucGxheWVyLmZpZ3VyZVszXT17eDowLWZsaXA0LnkseTpmbGlwNC54fTtcclxuXHJcbiAgICAgICAgICAgIC8qZm9yICh2YXIgaSA9IDA7IGk8NDtpKyspe1xyXG4gICAgICAgICAgICAgICAgZmxpcFtpXS54ID0gMSAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS55O1xyXG4gICAgICAgICAgICAgICAgZmxpcFtpXS55ID0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLng7XHJcbiAgICAgICAgICAgIH0qL1xyXG4gICAgICAgICAgICAvL0dhbWUucGxheWVyLmZpZ3VyZSA9IGZsaXA7XHJcbiAgICAgICAgICAgIEdhbWUubW92ZVBsYXllcigwLDApO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxufTtcclxuXHJcbkdhbWUudGljayA9IGZ1bmN0aW9uKCl7XHJcbiAgICBHYW1lLnVwZGF0ZSgpO1xyXG4gICAgR2FtZS5yZW5kZXIoKTtcclxufTtcclxuXHJcbkdhbWUucmVuZGVyID0gZnVuY3Rpb24oKXtcclxuICAgIEFwcC5jdHguY2xlYXJSZWN0KDAsIDAsIEFwcC5jYW52YXMud2lkdGgsIEFwcC5jYW52YXMuaGVpZ2h0KTtcclxuICAgIEZpZWxkLnJlbmRlcigpO1xyXG59O1xyXG5cclxuR2FtZS51cGRhdGUgPSBmdW5jdGlvbigpe1xyXG5cclxufTtcclxuXHJcbkdhbWUuc3Bhd24gPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIHNwYXducG9pbnQgPSB7eDogTWF0aC5mbG9vcihGaWVsZC53aWR0aC8yKS0xLHk6RmllbGQuaGVpZ2h0LTF9XHJcbiAgICBHYW1lLnBsYXllci5wb3NpdGlvbiA9IHNwYXducG9pbnQ7XHJcbiAgICAvLyBlaW5lIHp1ZsOkbGxpZ2UgRmlndXIgYXVzd8OkaGxlblxyXG4gICAgdmFyIGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKEJveGVzLmxlbmd0aCkpO1xyXG4gICAgdmFyIGZpZ3VyZSA9IEJveGVzW2luZGV4XTtcclxuICAgIEdhbWUucGxheWVyLmZpZ3VyZSA9IGZpZ3VyZTtcclxuXHJcbiAgICB2YXIgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoyNTYpO1xyXG4gICAgdmFyIGcgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMjU2KTtcclxuICAgIHZhciBiID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjI1Nik7XHJcblxyXG4gICAgR2FtZS5wbGF5ZXIuY29sb3IgPSAncmdiKCcrcisnLCcrZysnLCcrYisnKSc7XHJcblxyXG4gICAgLy8gSmVkZSBLb29yZGluYXRlIGRlciBnZXfDpGhsdGVuIEZpZ3VyIGl0ZXJpZXJlblxyXG4gICAgZm9yICh2YXIgaT0wO2k8NDtpKyspe1xyXG4gICAgICAgIC8vIEtvb3JkaW5hdGUgaW0gU3BpZWxmZWxkIHNldHplblxyXG4gICAgICAgIEZpZWxkLmZpZWxkW3NwYXducG9pbnQueCAtIGZpZ3VyZVtpXS54XVtzcGF3bnBvaW50LnkgLSBmaWd1cmVbaV0ueV0gPSB7XHJcbiAgICAgICAgICAgIHNob3c6IHRydWUsXHJcbiAgICAgICAgICAgIGNvbG9yOiBHYW1lLnBsYXllci5jb2xvclxyXG4gICAgICAgIH07XHJcbiAgICB9ICBcclxufTtcclxuXHJcblxyXG5HYW1lLm1vdmVQbGF5ZXIgPSBmdW5jdGlvbih4LHkpe1xyXG5cclxuICAgIC8vVGVzdCBpZiBib3ggd291bGQgYmUgc3RpbGwgaW4gZmllbGRcclxuICAgIGZvciAodmFyIGk9MDtpPDQ7aSsrKXtcclxuICAgICAgICBpZiAoR2FtZS5wbGF5ZXIucG9zaXRpb24ueCAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS54ICsgeCA8IDAgfHwgR2FtZS5wbGF5ZXIucG9zaXRpb24ueCAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS54ICsgeCA+PSBGaWVsZC53aWR0aCl7XHJcbiAgICAgICAgICAgIHggPSAwO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoR2FtZS5wbGF5ZXIucG9zaXRpb24ueSAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS55ICsgeSA8IDApe1xyXG4gICAgICAgICAgICBHYW1lLnNwYXduKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IFxyXG4gICAgICAgIFxyXG4gICAgfVxyXG4gICAgLy8gSmVkZSBLb29yZGluYXRlIGRlciBnZXfDpGhsdGVuIEZpZ3VyIGl0ZXJpZXJlblxyXG4gICAgZm9yICh2YXIgaT0wO2k8NDtpKyspe1xyXG4gICAgICAgIC8vIEtvb3JkaW5hdGUgaW0gU3BpZWxmZWxkIHNldHplblxyXG4gICAgICAgIEZpZWxkLmZpZWxkW0dhbWUucGxheWVyLnBvc2l0aW9uLnggLSBHYW1lLnBsYXllci5maWd1cmVbaV0ueF1bR2FtZS5wbGF5ZXIucG9zaXRpb24ueSAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS55XSA9IHtcclxuICAgICAgICAgICAgc2hvdzogZmFsc2UsXHJcbiAgICAgICAgICAgIGNvbG9yOiBcImdyZWVuXCJcclxuICAgICAgICB9O1xyXG4gICAgfSAgXHJcblxyXG4gICAgLy9UZXN0IGlmIGJveCB3b3VsZCBjb2xsaWRlIHdpdGggb3RoZXIgYm94ZXNcclxuICAgIGZvciAodmFyIGk9MDtpPDQ7aSsrKXtcclxuICAgICAgICBpZiAoIEZpZWxkLmZpZWxkW0dhbWUucGxheWVyLnBvc2l0aW9uLnggLSBHYW1lLnBsYXllci5maWd1cmVbaV0ueCt4XVtHYW1lLnBsYXllci5wb3NpdGlvbi55IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLnkreV0uc2hvdyA9PSB0cnVlKXtcclxuICAgICAgICAgICAgdGhpcy54PTA7XHJcbiAgICAgICAgICAgIHRoaXMueT0wO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqPTA7ajw0O2orKyl7XHJcbiAgICAgICAgICAgICAgICBGaWVsZC5maWVsZFtHYW1lLnBsYXllci5wb3NpdGlvbi54IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2pdLnhdW0dhbWUucGxheWVyLnBvc2l0aW9uLnkgLSBHYW1lLnBsYXllci5maWd1cmVbal0ueV0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvdzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBjb2xvcjogR2FtZS5wbGF5ZXIuY29sb3JcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgR2FtZS5zcGF3bigpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEdhbWUucGxheWVyLnBvc2l0aW9uLnkrPXk7XHJcbiAgICBHYW1lLnBsYXllci5wb3NpdGlvbi54Kz14O1xyXG4gICAgLy8gSmVkZSBLb29yZGluYXRlIGRlciBnZXfDpGhsdGVuIEZpZ3VyIGl0ZXJpZXJlblxyXG4gICAgLy8gS29vcmRpbmF0ZSBpbSBTcGllbGZlbGQgc2V0emVuXHJcbiAgICBmb3IgKHZhciBpPTA7aTw0O2krKyl7XHJcbiAgICAgICAgRmllbGQuZmllbGRbR2FtZS5wbGF5ZXIucG9zaXRpb24ueCAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS54XVtHYW1lLnBsYXllci5wb3NpdGlvbi55IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLnldID0ge1xyXG4gICAgICAgICAgICBzaG93OiB0cnVlLFxyXG4gICAgICAgICAgICBjb2xvcjogR2FtZS5wbGF5ZXIuY29sb3JcclxuICAgICAgICB9O1xyXG4gICAgfSAgXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XHJcbiIsInZhciBHYW1lID0gcmVxdWlyZSgnLi9HYW1lLmpzJyk7XHJcbnZhciBBcHAgPSByZXF1aXJlKCcuL0FwcC5qcycpO1xyXG52YXIgRmllbGQgPSByZXF1aXJlKCcuL0ZpZWxkLmpzJyk7XHJcblxyXG5BcHAuaW5pdCgpO1xyXG5GaWVsZC5pbml0KCk7XHJcblxyXG5HYW1lLnNwYXduKCk7XHJcblxyXG5HYW1lLnN0YXJ0KCk7Il19
