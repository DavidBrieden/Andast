(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var App = {};

App.init = function () {
    this.canvas = document.getElementById("canvas");
    this.canvas.width = 800;
    this.canvas.height = 600;
    this.ctx = this.canvas.getContext("2d");
};

module.exports = App;

},{}],2:[function(require,module,exports){
"use strict";

var boxes = [];

// X
//XXX
boxes.push([{ x: -1, y: 0 }, { x: 0, y: 0 }, { x: 1, y: 0 }, { x: 0, y: 1 }]);
//XX
// XX
boxes.push([{ x: -1, y: 1 }, { x: 0, y: 1 }, { x: 0, y: 0 }, { x: 1, y: 0 }]);
//XX
//XX
boxes.push([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 0 }, { x: 1, y: 1 }]);
//X
//X
//X
//X
boxes.push([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: 2 }, { x: 0, y: -1 }]);
//X
//X
//XX
boxes.push([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: -1 }, { x: -1, y: -1 }]);
// X
// X
//XX
boxes.push([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: -1 }, { x: 1, y: -1 }]);
// XX
//XX
boxes.push([{ x: -1, y: 0 }, { x: 0, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 1 }]);

module.exports = boxes;

},{}],3:[function(require,module,exports){
"use strict";

var App = require("./App.js");

var Field = {};

Field.init = function () {

    Field.offsetx = 20;
    Field.offsety = 20;
    Field.blocksize = 10;
    Field.width = 20;
    Field.height = 40;

    Field.field = [];
    for (var x = 0; x < Field.width; x++) {
        var column = [];
        for (var y = 0; y < Field.height; y++) {
            column.push({
                show: false,
                color: 0
            });
        }
        Field.field.push(column);
    }
};

Field.render = function () {
    for (var x = 0; x < Field.width; x++) {
        for (var y = 0; y < Field.height; y++) {
            if (Field.field[x][y].show == true) {
                App.ctx.beginPath();
                App.ctx.lineWidth = "3";
                App.ctx.strokeStyle = Field.field[x][y].color;
                App.ctx.fillStyle = "black";

                App.ctx.fillRect(x * Field.blocksize + Field.offsetx, (Field.height - 1) * Field.blocksize + Field.offsety - y * Field.blocksize, Field.blocksize, Field.blocksize);

                App.ctx.fillStyle = Field.field[x][y].color;

                App.ctx.fillRect(x * Field.blocksize + Field.offsetx + Field.blocksize / 10, (Field.height - 1) * Field.blocksize + Field.offsety - y * Field.blocksize + Field.blocksize / 10, Field.blocksize / 10 * 8, Field.blocksize / 10 * 8);

                App.ctx.stroke();
            }
        }
    }

    App.ctx.beginPath();
    App.ctx.lineWidth = "1";
    App.ctx.strokeStyle = "black";
    App.ctx.rect(Field.offsetx, Field.offsety, Field.width * Field.blocksize, Field.height * Field.blocksize);
    App.ctx.stroke();
};

module.exports = Field;

},{"./App.js":1}],4:[function(require,module,exports){
'use strict';

var Field = require('./Field.js');
var App = require('./App.js');
var Boxes = require('./Boxes.js');
var Game = {};

Game.player = {};

Game.start = function () {
    setInterval(this.tick, 50);
    setInterval(function () {
        Game.movePlayer(0, -1);
    }, 1000);
    document.addEventListener("keydown", function (e) {
        if (e.keyCode == '40') {
            // down arrow
            Game.movePlayer(0, -1);
        } else if (e.keyCode == '37') {
            // left arrow
            Game.movePlayer(-1, 0);
        } else if (e.keyCode == '39') {
            // right arrow
            Game.movePlayer(1, 0);
        } else if (e.keyCode == '38') {
            // up arrow
            Game.spawn();
        } else if (e.keyCode == '32') {
            // press space to flip boxes

            // prevent scrolling
            e.preventDefault();
            var flip = Array.from(Game.player.figure);
            for (var i = 0; i < 4; i++) {
                // Koordinate im Spielfeld setzen
                Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
                    show: false,
                    color: "green"
                };
                Game.player.figure[i] = {
                    x: 0 - flip[i].y,
                    y: flip[i].x
                };
                /*if (Field.field[Game.player.position.x-x][Game.player.position.y - y].show==true){
                    Game.player.figure = flip;
                }*/
            }
            // damit das Spielfeld direkt geupdatet wird
            Game.movePlayer(0, 0);
        }
    });
};

Game.tick = function () {
    Game.update();
    Game.render();
};

Game.render = function () {
    App.ctx.clearRect(0, 0, App.canvas.width, App.canvas.height);
    Field.render();
};

Game.update = function () {};

Game.spawn = function () {
    var spawnpoint = { x: Math.floor(Field.width / 2) - 1, y: Field.height - 1 };
    Game.player.position = spawnpoint;
    // eine zufällige Figur auswählen
    var index = Math.floor(Math.random() * Boxes.length);
    var figure = Array.from(Boxes[index]);
    Game.player.figure = figure;

    var r = Math.floor(Math.random() * 256);
    var g = Math.floor(Math.random() * 256);
    var b = Math.floor(Math.random() * 256);

    Game.player.color = 'rgb(' + r + ',' + g + ',' + b + ')';

    // Jede Koordinate der gewählten Figur iterieren
    for (var i = 0; i < 4; i++) {
        // Koordinate im Spielfeld setzen
        Field.field[spawnpoint.x - figure[i].x][spawnpoint.y - figure[i].y] = {
            show: true,
            color: Game.player.color
        };
    }
};

Game.movePlayer = function (x, y) {

    //Test if box would be still in field
    for (var i = 0; i < 4; i++) {
        if (Game.player.position.x - Game.player.figure[i].x + x < 0 || Game.player.position.x - Game.player.figure[i].x + x >= Field.width) {
            x = 0;
        } else if (Game.player.position.y - Game.player.figure[i].y + y < 0) {
            Game.spawn();
            return;
        }
    }
    // Jede Koordinate der gewählten Figur iterieren
    for (var i = 0; i < 4; i++) {
        // Koordinate im Spielfeld setzen
        Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
            show: false,
            color: "green"
        };
    }

    //Test if box would collide with other boxes
    for (var i = 0; i < 4; i++) {
        if (Field.field[Game.player.position.x - Game.player.figure[i].x + x][Game.player.position.y - Game.player.figure[i].y + y].show == true) {
            if (x == 0) {
                x = 0;
                y = 0;
                for (var j = 0; j < 4; j++) {
                    Field.field[Game.player.position.x - Game.player.figure[j].x][Game.player.position.y - Game.player.figure[j].y] = {
                        show: true,
                        color: Game.player.color
                    };
                }
                Game.spawn();
                return;
            } else {
                x = 0;
            }
        }
    }

    Game.player.position.y += y;
    Game.player.position.x += x;
    // Jede Koordinate der gewählten Figur iterieren
    for (var i = 0; i < 4; i++) {
        // Koordinate im Spielfeld setzen
        Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
            show: true,
            color: Game.player.color
        };
    }
};

module.exports = Game;

},{"./App.js":1,"./Boxes.js":2,"./Field.js":3}],5:[function(require,module,exports){
'use strict';

var Game = require('./Game.js');
var App = require('./App.js');
var Field = require('./Field.js');

App.init();
Field.init();

Game.spawn();

Game.start();

},{"./App.js":1,"./Field.js":3,"./Game.js":4}]},{},[5])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmNcXGNsaWVudFxcc2NyaXB0c1xcQXBwLmpzIiwic3JjXFxjbGllbnRcXHNjcmlwdHNcXEJveGVzLmpzIiwic3JjXFxjbGllbnRcXHNjcmlwdHNcXEZpZWxkLmpzIiwic3JjXFxjbGllbnRcXHNjcmlwdHNcXEdhbWUuanMiLCJzcmNcXGNsaWVudFxcc2NyaXB0c1xcbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBSSxNQUFNLEVBQVY7O0FBRUEsSUFBSSxJQUFKLEdBQVcsWUFBVTtBQUNqQixTQUFLLE1BQUwsR0FBYyxTQUFTLGNBQVQsQ0FBd0IsUUFBeEIsQ0FBZDtBQUNBLFNBQUssTUFBTCxDQUFZLEtBQVosR0FBb0IsR0FBcEI7QUFDQSxTQUFLLE1BQUwsQ0FBWSxNQUFaLEdBQXFCLEdBQXJCO0FBQ0EsU0FBSyxHQUFMLEdBQVcsS0FBSyxNQUFMLENBQVksVUFBWixDQUF1QixJQUF2QixDQUFYO0FBQ0gsQ0FMRDs7QUFPQSxPQUFPLE9BQVAsR0FBaUIsR0FBakI7Ozs7O0FDVEEsSUFBSSxRQUFRLEVBQVo7O0FBRUE7QUFDQTtBQUNBLE1BQU0sSUFBTixDQUFXLENBQUMsRUFBQyxHQUFFLENBQUMsQ0FBSixFQUFNLEdBQUUsQ0FBUixFQUFELEVBQVksRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBWixFQUFzQixFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUF0QixFQUFnQyxFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUFoQyxDQUFYO0FBQ0E7QUFDQTtBQUNBLE1BQU0sSUFBTixDQUFXLENBQUMsRUFBQyxHQUFFLENBQUMsQ0FBSixFQUFNLEdBQUUsQ0FBUixFQUFELEVBQVksRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBWixFQUFzQixFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxF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QixDQUEzRCxFQUE4RCxLQUFLLE1BQUwsQ0FBWSxRQUFaLENBQXFCLENBQXJCLEdBQXlCLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsRUFBc0IsQ0FBN0csSUFBa0g7QUFDOUcsa0JBQU0sSUFEd0c7QUFFOUcsbUJBQU8sS0FBSyxNQUFMLENBQVk7QUFGMkYsU0FBbEg7QUFJSDtBQUNKLENBbkREOztBQXFEQSxPQUFPLE9BQVAsR0FBaUIsSUFBakI7Ozs7O0FDakpBLElBQUksT0FBTyxRQUFRLFdBQVIsQ0FBWDtBQUNBLElBQUksTUFBTSxRQUFRLFVBQVIsQ0FBVjtBQUNBLElBQUksUUFBUSxRQUFRLFlBQVIsQ0FBWjs7QUFFQSxJQUFJLElBQUo7QUFDQSxNQUFNLElBQU47O0FBRUEsS0FBSyxLQUFMOztBQUVBLEtBQUssS0FBTCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJ2YXIgQXBwID0ge307XHJcblxyXG5BcHAuaW5pdCA9IGZ1bmN0aW9uKCl7XHJcbiAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FudmFzXCIpO1xyXG4gICAgdGhpcy5jYW52YXMud2lkdGggPSA4MDA7XHJcbiAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSA2MDA7XHJcbiAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQXBwOyIsInZhciBib3hlcyA9IFtdO1xyXG5cclxuLy8gWFxyXG4vL1hYWFxyXG5ib3hlcy5wdXNoKFt7eDotMSx5OjB9LHt4OjAseTowfSx7eDoxLHk6MH0se3g6MCx5OjF9XSk7XHJcbi8vWFhcclxuLy8gWFhcclxuYm94ZXMucHVzaChbe3g6LTEseToxfSx7eDowLHk6MX0se3g6MCx5OjB9LHt4OjEseTowfV0pO1xyXG4vL1hYXHJcbi8vWFhcclxuYm94ZXMucHVzaChbe3g6MCx5OjB9LHt4OjAseToxfSx7eDoxLHk6MH0se3g6MSx5OjF9XSk7XHJcbi8vWFxyXG4vL1hcclxuLy9YXHJcbi8vWFxyXG5ib3hlcy5wdXNoKFt7eDowLHk6MH0se3g6MCx5OjF9LHt4OjAseToyfSx7eDowLHk6LTF9XSk7XHJcbi8vWFxyXG4vL1hcclxuLy9YWFxyXG5ib3hlcy5wdXNoKFt7eDowLHk6MH0se3g6MCx5OjF9LHt4OjAseTotMX0se3g6LTEseTotMX1dKTtcclxuLy8gWFxyXG4vLyBYXHJcbi8vWFhcclxuYm94ZXMucHVzaChbe3g6MCx5OjB9LHt4OjAseToxfSx7eDowLHk6LTF9LHt4OjEseTotMX1dKTtcclxuLy8gWFhcclxuLy9YWFxyXG5ib3hlcy5wdXNoKFt7eDotMSx5OjB9LHt4OjAseTowfSx7eDowLHk6MX0se3g6MSx5OjF9XSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGJveGVzO1xyXG4iLCJ2YXIgQXBwID0gcmVxdWlyZShcIi4vQXBwLmpzXCIpO1xyXG5cclxuXHJcbnZhciBGaWVsZCA9IHt9O1xyXG5cclxuRmllbGQuaW5pdCA9IGZ1bmN0aW9uKCl7XHJcblxyXG4gICAgRmllbGQub2Zmc2V0eCA9IDIwO1xyXG4gICAgRmllbGQub2Zmc2V0eSA9IDIwO1xyXG4gICAgRmllbGQuYmxvY2tzaXplID0gMTA7XHJcbiAgICBGaWVsZC53aWR0aCA9IDIwO1xyXG4gICAgRmllbGQuaGVpZ2h0ID0gNDA7XHJcblxyXG4gICAgRmllbGQuZmllbGQgPSBbXTtcclxuICAgIGZvcih2YXIgeD0wO3g8RmllbGQud2lkdGg7eCsrKXtcclxuICAgICAgICB2YXIgY29sdW1uID0gW107XHJcbiAgICAgICAgZm9yKHZhciB5PTA7eTxGaWVsZC5oZWlnaHQ7eSsrKXtcclxuICAgICAgICAgICAgY29sdW1uLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgc2hvdzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjogMFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgRmllbGQuZmllbGQucHVzaChjb2x1bW4pO1xyXG4gICAgfVxyXG4gICAgXHJcblxyXG59O1xyXG5cclxuXHJcbkZpZWxkLnJlbmRlciA9IGZ1bmN0aW9uKCl7XHJcbiAgICBmb3IodmFyIHg9MDt4PEZpZWxkLndpZHRoO3grKyl7XHJcbiAgICAgICAgZm9yKHZhciB5PTA7eTxGaWVsZC5oZWlnaHQ7eSsrKXtcclxuICAgICAgICAgICAgaWYgKEZpZWxkLmZpZWxkW3hdW3ldLnNob3cgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgQXBwLmN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgICAgICAgICAgIEFwcC5jdHgubGluZVdpZHRoPVwiM1wiO1xyXG4gICAgICAgICAgICAgICAgQXBwLmN0eC5zdHJva2VTdHlsZSA9IEZpZWxkLmZpZWxkW3hdW3ldLmNvbG9yO1xyXG4gICAgICAgICAgICAgICAgQXBwLmN0eC5maWxsU3R5bGUgPSBcImJsYWNrXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgQXBwLmN0eC5maWxsUmVjdChcclxuICAgICAgICAgICAgICAgICAgICB4KkZpZWxkLmJsb2Nrc2l6ZStGaWVsZC5vZmZzZXR4LFxyXG4gICAgICAgICAgICAgICAgICAgICgoRmllbGQuaGVpZ2h0LTEpKkZpZWxkLmJsb2Nrc2l6ZSkrRmllbGQub2Zmc2V0eS0oeSpGaWVsZC5ibG9ja3NpemUpLFxyXG4gICAgICAgICAgICAgICAgICAgIEZpZWxkLmJsb2Nrc2l6ZSxcclxuICAgICAgICAgICAgICAgICAgICBGaWVsZC5ibG9ja3NpemVcclxuICAgICAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICAgICAgQXBwLmN0eC5maWxsU3R5bGUgPSBGaWVsZC5maWVsZFt4XVt5XS5jb2xvcjtcclxuXHJcbiAgICAgICAgICAgICAgICBBcHAuY3R4LmZpbGxSZWN0KFxyXG4gICAgICAgICAgICAgICAgICAgIHgqRmllbGQuYmxvY2tzaXplK0ZpZWxkLm9mZnNldHgrRmllbGQuYmxvY2tzaXplLzEwLFxyXG4gICAgICAgICAgICAgICAgICAgICgoRmllbGQuaGVpZ2h0LTEpKkZpZWxkLmJsb2Nrc2l6ZSkrRmllbGQub2Zmc2V0eS0oeSpGaWVsZC5ibG9ja3NpemUpK0ZpZWxkLmJsb2Nrc2l6ZS8xMCxcclxuICAgICAgICAgICAgICAgICAgICBGaWVsZC5ibG9ja3NpemUvMTAqOCxcclxuICAgICAgICAgICAgICAgICAgICBGaWVsZC5ibG9ja3NpemUvMTAqOFxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBBcHAuY3R4LnN0cm9rZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEFwcC5jdHguYmVnaW5QYXRoKCk7XHJcbiAgICBBcHAuY3R4LmxpbmVXaWR0aD1cIjFcIjtcclxuICAgIEFwcC5jdHguc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XHJcbiAgICBBcHAuY3R4LnJlY3QoXHJcbiAgICAgICAgRmllbGQub2Zmc2V0eCxcclxuICAgICAgICBGaWVsZC5vZmZzZXR5LFxyXG4gICAgICAgIEZpZWxkLndpZHRoKkZpZWxkLmJsb2Nrc2l6ZSxcclxuICAgICAgICBGaWVsZC5oZWlnaHQgKiBGaWVsZC5ibG9ja3NpemVcclxuICAgICk7XHJcbiAgICBBcHAuY3R4LnN0cm9rZSgpO1xyXG59O1xyXG5cclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEZpZWxkOyIsInZhciBGaWVsZCA9IHJlcXVpcmUoJy4vRmllbGQuanMnKTtcclxudmFyIEFwcCA9IHJlcXVpcmUoJy4vQXBwLmpzJyk7XHJcbnZhciBCb3hlcyA9IHJlcXVpcmUoJy4vQm94ZXMuanMnKTtcclxudmFyIEdhbWUgPSB7fTtcclxuXHJcbkdhbWUucGxheWVyID0ge307XHJcblxyXG5HYW1lLnN0YXJ0ID0gZnVuY3Rpb24oKXtcclxuICAgIHNldEludGVydmFsKHRoaXMudGljaywgNTApO1xyXG4gICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtHYW1lLm1vdmVQbGF5ZXIoMCwtMSl9LCAxMDAwKTtcclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgIGlmIChlLmtleUNvZGUgPT0gJzQwJykge1xyXG4gICAgICAgICAgICAvLyBkb3duIGFycm93XHJcbiAgICAgICAgICAgIEdhbWUubW92ZVBsYXllcigwLC0xKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZS5rZXlDb2RlID09ICczNycpIHtcclxuICAgICAgICAgICAgLy8gbGVmdCBhcnJvd1xyXG4gICAgICAgICAgICBHYW1lLm1vdmVQbGF5ZXIoLTEsMCk7ICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGUua2V5Q29kZSA9PSAnMzknKSB7XHJcbiAgICAgICAgICAgIC8vIHJpZ2h0IGFycm93XHJcbiAgICAgICAgICAgIEdhbWUubW92ZVBsYXllcigxLDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzM4Jykge1xyXG4gICAgICAgICAgICAvLyB1cCBhcnJvd1xyXG4gICAgICAgICAgICBHYW1lLnNwYXduKCk7XHJcbiAgICAgICAgfWVsc2UgaWYgKGUua2V5Q29kZSA9PSAnMzInKSB7XHJcbiAgICAgICAgICAgIC8vIHByZXNzIHNwYWNlIHRvIGZsaXAgYm94ZXNcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIHByZXZlbnQgc2Nyb2xsaW5nXHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdmFyIGZsaXAgPSBBcnJheS5mcm9tKEdhbWUucGxheWVyLmZpZ3VyZSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPDQ7aSsrKXtcclxuICAgICAgICAgICAgICAgIC8vIEtvb3JkaW5hdGUgaW0gU3BpZWxmZWxkIHNldHplblxyXG4gICAgICAgICAgICAgICAgRmllbGQuZmllbGRbR2FtZS5wbGF5ZXIucG9zaXRpb24ueCAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS54XVtHYW1lLnBsYXllci5wb3NpdGlvbi55IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLnldID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3c6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBcImdyZWVuXCJcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBHYW1lLnBsYXllci5maWd1cmVbaV09e1xyXG4gICAgICAgICAgICAgICAgICAgIHg6MC1mbGlwW2ldLnksXHJcbiAgICAgICAgICAgICAgICAgICAgeTpmbGlwW2ldLnhcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAvKmlmIChGaWVsZC5maWVsZFtHYW1lLnBsYXllci5wb3NpdGlvbi54LXhdW0dhbWUucGxheWVyLnBvc2l0aW9uLnkgLSB5XS5zaG93PT10cnVlKXtcclxuICAgICAgICAgICAgICAgICAgICBHYW1lLnBsYXllci5maWd1cmUgPSBmbGlwO1xyXG4gICAgICAgICAgICAgICAgfSovXHJcbiAgICAgICAgICAgIH0gIFxyXG4gICAgICAgICAgICAvLyBkYW1pdCBkYXMgU3BpZWxmZWxkIGRpcmVrdCBnZXVwZGF0ZXQgd2lyZFxyXG4gICAgICAgICAgICBHYW1lLm1vdmVQbGF5ZXIoMCwwKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbn07XHJcblxyXG5HYW1lLnRpY2sgPSBmdW5jdGlvbigpe1xyXG4gICAgR2FtZS51cGRhdGUoKTtcclxuICAgIEdhbWUucmVuZGVyKCk7XHJcbn07XHJcblxyXG5HYW1lLnJlbmRlciA9IGZ1bmN0aW9uKCl7XHJcbiAgICBBcHAuY3R4LmNsZWFyUmVjdCgwLCAwLCBBcHAuY2FudmFzLndpZHRoLCBBcHAuY2FudmFzLmhlaWdodCk7XHJcbiAgICBGaWVsZC5yZW5kZXIoKTtcclxufTtcclxuXHJcbkdhbWUudXBkYXRlID0gZnVuY3Rpb24oKXtcclxuXHJcbn07XHJcblxyXG5HYW1lLnNwYXduID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBzcGF3bnBvaW50ID0ge3g6IE1hdGguZmxvb3IoRmllbGQud2lkdGgvMiktMSx5OkZpZWxkLmhlaWdodC0xfVxyXG4gICAgR2FtZS5wbGF5ZXIucG9zaXRpb24gPSBzcGF3bnBvaW50O1xyXG4gICAgLy8gZWluZSB6dWbDpGxsaWdlIEZpZ3VyIGF1c3fDpGhsZW5cclxuICAgIHZhciBpbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChCb3hlcy5sZW5ndGgpKTtcclxuICAgIHZhciBmaWd1cmUgPSBBcnJheS5mcm9tKEJveGVzW2luZGV4XSk7XHJcbiAgICBHYW1lLnBsYXllci5maWd1cmUgPSBmaWd1cmU7XHJcblxyXG4gICAgdmFyIHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMjU2KTtcclxuICAgIHZhciBnID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjI1Nik7XHJcbiAgICB2YXIgYiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoyNTYpO1xyXG5cclxuICAgIEdhbWUucGxheWVyLmNvbG9yID0gJ3JnYignK3IrJywnK2crJywnK2IrJyknO1xyXG5cclxuICAgIC8vIEplZGUgS29vcmRpbmF0ZSBkZXIgZ2V3w6RobHRlbiBGaWd1ciBpdGVyaWVyZW5cclxuICAgIGZvciAodmFyIGk9MDtpPDQ7aSsrKXtcclxuICAgICAgICAvLyBLb29yZGluYXRlIGltIFNwaWVsZmVsZCBzZXR6ZW5cclxuICAgICAgICBGaWVsZC5maWVsZFtzcGF3bnBvaW50LnggLSBmaWd1cmVbaV0ueF1bc3Bhd25wb2ludC55IC0gZmlndXJlW2ldLnldID0ge1xyXG4gICAgICAgICAgICBzaG93OiB0cnVlLFxyXG4gICAgICAgICAgICBjb2xvcjogR2FtZS5wbGF5ZXIuY29sb3JcclxuICAgICAgICB9O1xyXG4gICAgfSAgXHJcbn07XHJcblxyXG5cclxuR2FtZS5tb3ZlUGxheWVyID0gZnVuY3Rpb24oeCx5KXtcclxuXHJcbiAgICAvL1Rlc3QgaWYgYm94IHdvdWxkIGJlIHN0aWxsIGluIGZpZWxkXHJcbiAgICBmb3IgKHZhciBpPTA7aTw0O2krKyl7XHJcbiAgICAgICAgaWYgKEdhbWUucGxheWVyLnBvc2l0aW9uLnggLSBHYW1lLnBsYXllci5maWd1cmVbaV0ueCArIHggPCAwIHx8IEdhbWUucGxheWVyLnBvc2l0aW9uLnggLSBHYW1lLnBsYXllci5maWd1cmVbaV0ueCArIHggPj0gRmllbGQud2lkdGgpe1xyXG4gICAgICAgICAgICB4ID0gMDtcclxuICAgICAgICB9IGVsc2UgaWYgKEdhbWUucGxheWVyLnBvc2l0aW9uLnkgLSBHYW1lLnBsYXllci5maWd1cmVbaV0ueSArIHkgPCAwKXtcclxuICAgICAgICAgICAgR2FtZS5zcGF3bigpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBcclxuICAgICAgICBcclxuICAgIH1cclxuICAgIC8vIEplZGUgS29vcmRpbmF0ZSBkZXIgZ2V3w6RobHRlbiBGaWd1ciBpdGVyaWVyZW5cclxuICAgIGZvciAodmFyIGk9MDtpPDQ7aSsrKXtcclxuICAgICAgICAvLyBLb29yZGluYXRlIGltIFNwaWVsZmVsZCBzZXR6ZW5cclxuICAgICAgICBGaWVsZC5maWVsZFtHYW1lLnBsYXllci5wb3NpdGlvbi54IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLnhdW0dhbWUucGxheWVyLnBvc2l0aW9uLnkgLSBHYW1lLnBsYXllci5maWd1cmVbaV0ueV0gPSB7XHJcbiAgICAgICAgICAgIHNob3c6IGZhbHNlLFxyXG4gICAgICAgICAgICBjb2xvcjogXCJncmVlblwiXHJcbiAgICAgICAgfTtcclxuICAgIH0gIFxyXG5cclxuICAgIC8vVGVzdCBpZiBib3ggd291bGQgY29sbGlkZSB3aXRoIG90aGVyIGJveGVzXHJcbiAgICBmb3IgKHZhciBpPTA7aTw0O2krKyl7XHJcbiAgICAgICAgaWYgKCBGaWVsZC5maWVsZFtHYW1lLnBsYXllci5wb3NpdGlvbi54IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLngreF1bR2FtZS5wbGF5ZXIucG9zaXRpb24ueSAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS55K3ldLnNob3cgPT0gdHJ1ZSl7XHJcbiAgICAgICAgICAgIGlmICh4ID09IDApeyAgIFxyXG4gICAgICAgICAgICAgICAgeD0wO1xyXG4gICAgICAgICAgICAgICAgeT0wO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaj0wO2o8NDtqKyspe1xyXG4gICAgICAgICAgICAgICAgICAgIEZpZWxkLmZpZWxkW0dhbWUucGxheWVyLnBvc2l0aW9uLnggLSBHYW1lLnBsYXllci5maWd1cmVbal0ueF1bR2FtZS5wbGF5ZXIucG9zaXRpb24ueSAtIEdhbWUucGxheWVyLmZpZ3VyZVtqXS55XSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IEdhbWUucGxheWVyLmNvbG9yXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIEdhbWUuc3Bhd24oKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHggPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIEdhbWUucGxheWVyLnBvc2l0aW9uLnkrPXk7XHJcbiAgICBHYW1lLnBsYXllci5wb3NpdGlvbi54Kz14O1xyXG4gICAgLy8gSmVkZSBLb29yZGluYXRlIGRlciBnZXfDpGhsdGVuIEZpZ3VyIGl0ZXJpZXJlblxyXG4gICAgZm9yICh2YXIgaT0wO2k8NDtpKyspe1xyXG4gICAgICAgIC8vIEtvb3JkaW5hdGUgaW0gU3BpZWxmZWxkIHNldHplblxyXG4gICAgICAgIEZpZWxkLmZpZWxkW0dhbWUucGxheWVyLnBvc2l0aW9uLnggLSBHYW1lLnBsYXllci5maWd1cmVbaV0ueF1bR2FtZS5wbGF5ZXIucG9zaXRpb24ueSAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS55XSA9IHtcclxuICAgICAgICAgICAgc2hvdzogdHJ1ZSxcclxuICAgICAgICAgICAgY29sb3I6IEdhbWUucGxheWVyLmNvbG9yXHJcbiAgICAgICAgfTtcclxuICAgIH0gIFxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBHYW1lO1xyXG4iLCJ2YXIgR2FtZSA9IHJlcXVpcmUoJy4vR2FtZS5qcycpO1xyXG52YXIgQXBwID0gcmVxdWlyZSgnLi9BcHAuanMnKTtcclxudmFyIEZpZWxkID0gcmVxdWlyZSgnLi9GaWVsZC5qcycpO1xyXG5cclxuQXBwLmluaXQoKTtcclxuRmllbGQuaW5pdCgpO1xyXG5cclxuR2FtZS5zcGF3bigpO1xyXG5cclxuR2FtZS5zdGFydCgpOyJdfQ==
