(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var App = {};

App.init = function () {
    this.canvas = document.getElementById("canvas");
    this.canvas.width = 800;
    this.canvas.height = 600;
    this.ctx = this.canvas.getContext("2d");
};

module.exports = App;

},{}],2:[function(require,module,exports){
"use strict";

var boxes = [];

// X
//XXX
boxes.push([{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: 2 }, { x: 1, y: 1 }]);
//XX
// XX
boxes.push([{ x: 1, y: 0 }, { x: 0, y: 1 }, { x: 0, y: 2 }, { x: 1, y: 1 }]);

module.exports = boxes;

},{}],3:[function(require,module,exports){
"use strict";

var App = require("./App.js");

var Field = {};

Field.init = function () {

    Field.offsetx = 20;
    Field.offsety = 20;
    Field.blocksize = 10;
    Field.width = 20;
    Field.height = 40;

    Field.field = [];
    for (var x = 0; x < Field.width; x++) {
        var column = [];
        for (var y = 0; y < Field.height; y++) {
            column.push({
                show: false,
                color: 0
            });
        }
        Field.field.push(column);
    }
};

Field.render = function () {
    for (var x = 0; x < Field.width; x++) {
        for (var y = 0; y < Field.height; y++) {
            if (Field.field[x][y].show == true) {
                App.ctx.beginPath();
                App.ctx.lineWidth = "3";
                App.ctx.strokeStyle = Field.field[x][y].color;

                App.ctx.rect(x * Field.blocksize + Field.offsetx, (Field.height - 1) * Field.blocksize + Field.offsety - y * Field.blocksize, Field.blocksize, Field.blocksize);
                App.ctx.stroke();
            }
        }
    }

    App.ctx.beginPath();
    App.ctx.lineWidth = "1";
    App.ctx.strokeStyle = "black";
    App.ctx.rect(Field.offsetx, Field.offsety, Field.width * Field.blocksize, Field.height * Field.blocksize);
    App.ctx.stroke();
};

module.exports = Field;

},{"./App.js":1}],4:[function(require,module,exports){
'use strict';

var Field = require('./Field.js');
var App = require('./App.js');
var Boxes = require('./Boxes.js');
var Game = {};

Game.player = {};

Game.start = function () {
    setInterval(this.tick, 50);
    setInterval(function () {
        Game.movePlayer(0, -1);
    }, 1000);
    document.addEventListener("keydown", function (e) {
        if (e.keyCode == '40') {
            // down arrow
            Game.movePlayer(0, -1);
        } else if (e.keyCode == '37') {
            // left arrow
            Game.movePlayer(-1, 0);
        } else if (e.keyCode == '39') {
            // right arrow
            Game.movePlayer(1, 0);
        } else if (e.keyCode == '38') {
            // up arrow
            Game.spawn();
        } else if (e.keyCode == '32') {
            // press space to flip boxes

            // prevent scrolling
            e.preventDefault();
            var flip = Array.from(Game.player.figure);
            for (var i = 0; i < 4; i++) {
                // Koordinate im Spielfeld setzen
                Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
                    show: false,
                    color: "green"
                };
                Game.player.figure[i] = {
                    x: 0 - flip[i].y,
                    y: flip[i].x
                };
            }
            // damit das Spielfeld direkt geupdatet wird
            Game.movePlayer(0, 0);
        }
    });
};

Game.tick = function () {
    Game.update();
    Game.render();
};

Game.render = function () {
    App.ctx.clearRect(0, 0, App.canvas.width, App.canvas.height);
    Field.render();
};

Game.update = function () {};

Game.spawn = function () {
    var spawnpoint = { x: Math.floor(Field.width / 2) - 1, y: Field.height - 1 };
    Game.player.position = spawnpoint;
    // eine zufällige Figur auswählen
    var index = Math.floor(Math.random() * Boxes.length);
    var figure = Array.from(Boxes[index]);
    Game.player.figure = figure;

    var r = Math.floor(Math.random() * 256);
    var g = Math.floor(Math.random() * 256);
    var b = Math.floor(Math.random() * 256);

    Game.player.color = 'rgb(' + r + ',' + g + ',' + b + ')';

    // Jede Koordinate der gewählten Figur iterieren
    for (var i = 0; i < 4; i++) {
        // Koordinate im Spielfeld setzen
        Field.field[spawnpoint.x - figure[i].x][spawnpoint.y - figure[i].y] = {
            show: true,
            color: Game.player.color
        };
    }
};

Game.movePlayer = function (x, y) {
    // Jede Koordinate der gewählten Figur iterieren
    for (var i = 0; i < 4; i++) {
        // Koordinate im Spielfeld setzen
        Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
            show: false,
            color: "green"
        };
    }
    Game.player.position.y += y;
    Game.player.position.x += x;
    // Jede Koordinate der gewählten Figur iterieren
    for (var i = 0; i < 4; i++) {
        // Koordinate im Spielfeld setzen
        Field.field[Game.player.position.x - Game.player.figure[i].x][Game.player.position.y - Game.player.figure[i].y] = {
            show: true,
            color: Game.player.color
        };
    }
};

module.exports = Game;

},{"./App.js":1,"./Boxes.js":2,"./Field.js":3}],5:[function(require,module,exports){
'use strict';

var Game = require('./Game.js');
var App = require('./App.js');
var Field = require('./Field.js');

App.init();
Field.init();

Game.spawn();

Game.start();

},{"./App.js":1,"./Field.js":3,"./Game.js":4}]},{},[5])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY2xpZW50L3NjcmlwdHMvQXBwLmpzIiwic3JjL2NsaWVudC9zY3JpcHRzL0JveGVzLmpzIiwic3JjL2NsaWVudC9zY3JpcHRzL0ZpZWxkLmpzIiwic3JjL2NsaWVudC9zY3JpcHRzL0dhbWUuanMiLCJzcmMvY2xpZW50L3NjcmlwdHMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsSUFBSSxNQUFNLEVBQVY7O0FBRUEsSUFBSSxJQUFKLEdBQVcsWUFBVTtBQUNqQixTQUFLLE1BQUwsR0FBYyxTQUFTLGNBQVQsQ0FBd0IsUUFBeEIsQ0FBZDtBQUNBLFNBQUssTUFBTCxDQUFZLEtBQVosR0FBb0IsR0FBcEI7QUFDQSxTQUFLLE1BQUwsQ0FBWSxNQUFaLEdBQXFCLEdBQXJCO0FBQ0EsU0FBSyxHQUFMLEdBQVcsS0FBSyxNQUFMLENBQVksVUFBWixDQUF1QixJQUF2QixDQUFYO0FBQ0gsQ0FMRDs7QUFPQSxPQUFPLE9BQVAsR0FBaUIsR0FBakI7Ozs7O0FDVEEsSUFBSSxRQUFRLEVBQVo7O0FBRUE7QUFDQTtBQUNBLE1BQU0sSUFBTixDQUFXLENBQUMsRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBRCxFQUFXLEVBQUMsR0FBRSxDQUFILEVBQUssR0FBRSxDQUFQLEVBQVgsRUFBcUIsRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBckIsRUFBK0IsRUFBQyxHQUFFLENBQUgsRUFBSyxHQUFFLENBQVAsRUFBL0IsQ0FBWDtBQUNBO0FBQ0E7QUFDQSxNQUFNLElBQU4sQ0FBVyxDQUFDLEVBQUMsR0FBRSxDQUFILEVBQUssR0FBRSxDQUFQLEVBQUQsRUFBVyxFQUFDLEdBQUUsQ0FBSCxFQUFLLEdBQUUsQ0FBUCxFQUFYLEVBQXFCLEVBQUMsR0FBRSxDQUFILEVBQUssR0FBRSxDQUFQLEVBQXJCLEVBQStCLEVBQUMsR0FBRSxDQUFI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WSxRQUFaLENBQXFCLENBQXJCLEdBQXlCLEtBQUssTUFBTCxDQUFZLE1BQVosQ0FBbUIsQ0FBbkIsRUFBc0IsQ0FBN0csSUFBa0g7QUFDOUcsa0JBQU0sSUFEd0c7QUFFOUcsbUJBQU8sS0FBSyxNQUFMLENBQVk7QUFGMkYsU0FBbEg7QUFJSDtBQUNKLENBbkJEOztBQXFCQSxPQUFPLE9BQVAsR0FBaUIsSUFBakI7Ozs7O0FDL0dBLElBQUksT0FBTyxRQUFRLFdBQVIsQ0FBWDtBQUNBLElBQUksTUFBTSxRQUFRLFVBQVIsQ0FBVjtBQUNBLElBQUksUUFBUSxRQUFRLFlBQVIsQ0FBWjs7QUFFQSxJQUFJLElBQUo7QUFDQSxNQUFNLElBQU47O0FBRUEsS0FBSyxLQUFMOztBQUVBLEtBQUssS0FBTCIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJ2YXIgQXBwID0ge307XG5cbkFwcC5pbml0ID0gZnVuY3Rpb24oKXtcbiAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FudmFzXCIpO1xuICAgIHRoaXMuY2FudmFzLndpZHRoID0gODAwO1xuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IDYwMDtcbiAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQXBwOyIsInZhciBib3hlcyA9IFtdO1xuXG4vLyBYXG4vL1hYWFxuYm94ZXMucHVzaChbe3g6MCx5OjB9LHt4OjAseToxfSx7eDowLHk6Mn0se3g6MSx5OjF9XSk7XG4vL1hYXG4vLyBYWFxuYm94ZXMucHVzaChbe3g6MSx5OjB9LHt4OjAseToxfSx7eDowLHk6Mn0se3g6MSx5OjF9XSk7XG5cbm1vZHVsZS5leHBvcnRzID0gYm94ZXM7XG4iLCJ2YXIgQXBwID0gcmVxdWlyZShcIi4vQXBwLmpzXCIpO1xuXG5cbnZhciBGaWVsZCA9IHt9O1xuXG5GaWVsZC5pbml0ID0gZnVuY3Rpb24oKXtcblxuICAgIEZpZWxkLm9mZnNldHggPSAyMDtcbiAgICBGaWVsZC5vZmZzZXR5ID0gMjA7XG4gICAgRmllbGQuYmxvY2tzaXplID0gMTA7XG4gICAgRmllbGQud2lkdGggPSAyMDtcbiAgICBGaWVsZC5oZWlnaHQgPSA0MDtcblxuICAgIEZpZWxkLmZpZWxkID0gW107XG4gICAgZm9yKHZhciB4PTA7eDxGaWVsZC53aWR0aDt4Kyspe1xuICAgICAgICB2YXIgY29sdW1uID0gW107XG4gICAgICAgIGZvcih2YXIgeT0wO3k8RmllbGQuaGVpZ2h0O3krKyl7XG4gICAgICAgICAgICBjb2x1bW4ucHVzaCh7XG4gICAgICAgICAgICAgICAgc2hvdzogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29sb3I6IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIEZpZWxkLmZpZWxkLnB1c2goY29sdW1uKTtcbiAgICB9XG4gICAgXG5cbn07XG5cblxuRmllbGQucmVuZGVyID0gZnVuY3Rpb24oKXtcbiAgICBmb3IodmFyIHg9MDt4PEZpZWxkLndpZHRoO3grKyl7XG4gICAgICAgIGZvcih2YXIgeT0wO3k8RmllbGQuaGVpZ2h0O3krKyl7XG4gICAgICAgICAgICBpZiAoRmllbGQuZmllbGRbeF1beV0uc2hvdyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgQXBwLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICBBcHAuY3R4LmxpbmVXaWR0aD1cIjNcIjtcbiAgICAgICAgICAgICAgICBBcHAuY3R4LnN0cm9rZVN0eWxlID0gRmllbGQuZmllbGRbeF1beV0uY29sb3I7XG5cbiAgICAgICAgICAgICAgICBBcHAuY3R4LnJlY3QoXG4gICAgICAgICAgICAgICAgICAgIHgqRmllbGQuYmxvY2tzaXplK0ZpZWxkLm9mZnNldHgsXG4gICAgICAgICAgICAgICAgICAgICgoRmllbGQuaGVpZ2h0LTEpKkZpZWxkLmJsb2Nrc2l6ZSkrRmllbGQub2Zmc2V0eS0oeSpGaWVsZC5ibG9ja3NpemUpLFxuICAgICAgICAgICAgICAgICAgICBGaWVsZC5ibG9ja3NpemUsXG4gICAgICAgICAgICAgICAgICAgIEZpZWxkLmJsb2Nrc2l6ZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgQXBwLmN0eC5zdHJva2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIEFwcC5jdHguYmVnaW5QYXRoKCk7XG4gICAgQXBwLmN0eC5saW5lV2lkdGg9XCIxXCI7XG4gICAgQXBwLmN0eC5zdHJva2VTdHlsZSA9IFwiYmxhY2tcIjtcbiAgICBBcHAuY3R4LnJlY3QoXG4gICAgICAgIEZpZWxkLm9mZnNldHgsXG4gICAgICAgIEZpZWxkLm9mZnNldHksXG4gICAgICAgIEZpZWxkLndpZHRoKkZpZWxkLmJsb2Nrc2l6ZSxcbiAgICAgICAgRmllbGQuaGVpZ2h0ICogRmllbGQuYmxvY2tzaXplXG4gICAgKTtcbiAgICBBcHAuY3R4LnN0cm9rZSgpO1xufTtcblxuXG5cbm1vZHVsZS5leHBvcnRzID0gRmllbGQ7IiwidmFyIEZpZWxkID0gcmVxdWlyZSgnLi9GaWVsZC5qcycpO1xudmFyIEFwcCA9IHJlcXVpcmUoJy4vQXBwLmpzJyk7XG52YXIgQm94ZXMgPSByZXF1aXJlKCcuL0JveGVzLmpzJyk7XG52YXIgR2FtZSA9IHt9O1xuXG5HYW1lLnBsYXllciA9IHt9O1xuXG5HYW1lLnN0YXJ0ID0gZnVuY3Rpb24oKXtcbiAgICBzZXRJbnRlcnZhbCh0aGlzLnRpY2ssIDUwKTtcbiAgICBzZXRJbnRlcnZhbChmdW5jdGlvbigpe0dhbWUubW92ZVBsYXllcigwLC0xKX0sIDEwMDApO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBpZiAoZS5rZXlDb2RlID09ICc0MCcpIHtcbiAgICAgICAgICAgIC8vIGRvd24gYXJyb3dcbiAgICAgICAgICAgIEdhbWUubW92ZVBsYXllcigwLC0xKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChlLmtleUNvZGUgPT0gJzM3Jykge1xuICAgICAgICAgICAgLy8gbGVmdCBhcnJvd1xuICAgICAgICAgICAgR2FtZS5tb3ZlUGxheWVyKC0xLDApOyAgICAgIFxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGUua2V5Q29kZSA9PSAnMzknKSB7XG4gICAgICAgICAgICAvLyByaWdodCBhcnJvd1xuICAgICAgICAgICAgR2FtZS5tb3ZlUGxheWVyKDEsMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZS5rZXlDb2RlID09ICczOCcpIHtcbiAgICAgICAgICAgIC8vIHVwIGFycm93XG4gICAgICAgICAgICBHYW1lLnNwYXduKCk7XG4gICAgICAgIH1lbHNlIGlmIChlLmtleUNvZGUgPT0gJzMyJykge1xuICAgICAgICAgICAgLy8gcHJlc3Mgc3BhY2UgdG8gZmxpcCBib3hlc1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBwcmV2ZW50IHNjcm9sbGluZ1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdmFyIGZsaXAgPSBBcnJheS5mcm9tKEdhbWUucGxheWVyLmZpZ3VyZSk7XG4gICAgICAgICAgICBmb3IgKHZhciBpPTA7aTw0O2krKyl7XG4gICAgICAgICAgICAgICAgLy8gS29vcmRpbmF0ZSBpbSBTcGllbGZlbGQgc2V0emVuXG4gICAgICAgICAgICAgICAgRmllbGQuZmllbGRbR2FtZS5wbGF5ZXIucG9zaXRpb24ueCAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS54XVtHYW1lLnBsYXllci5wb3NpdGlvbi55IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLnldID0ge1xuICAgICAgICAgICAgICAgICAgICBzaG93OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IFwiZ3JlZW5cIlxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgR2FtZS5wbGF5ZXIuZmlndXJlW2ldPXtcbiAgICAgICAgICAgICAgICAgICAgeDowLWZsaXBbaV0ueSxcbiAgICAgICAgICAgICAgICAgICAgeTpmbGlwW2ldLnhcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSAgXG4gICAgICAgICAgICAvLyBkYW1pdCBkYXMgU3BpZWxmZWxkIGRpcmVrdCBnZXVwZGF0ZXQgd2lyZFxuICAgICAgICAgICAgR2FtZS5tb3ZlUGxheWVyKDAsMCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxufTtcblxuR2FtZS50aWNrID0gZnVuY3Rpb24oKXtcbiAgICBHYW1lLnVwZGF0ZSgpO1xuICAgIEdhbWUucmVuZGVyKCk7XG59O1xuXG5HYW1lLnJlbmRlciA9IGZ1bmN0aW9uKCl7XG4gICAgQXBwLmN0eC5jbGVhclJlY3QoMCwgMCwgQXBwLmNhbnZhcy53aWR0aCwgQXBwLmNhbnZhcy5oZWlnaHQpO1xuICAgIEZpZWxkLnJlbmRlcigpO1xufTtcblxuR2FtZS51cGRhdGUgPSBmdW5jdGlvbigpe1xuXG59O1xuXG5HYW1lLnNwYXduID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgc3Bhd25wb2ludCA9IHt4OiBNYXRoLmZsb29yKEZpZWxkLndpZHRoLzIpLTEseTpGaWVsZC5oZWlnaHQtMX1cbiAgICBHYW1lLnBsYXllci5wb3NpdGlvbiA9IHNwYXducG9pbnQ7XG4gICAgLy8gZWluZSB6dWbDpGxsaWdlIEZpZ3VyIGF1c3fDpGhsZW5cbiAgICB2YXIgaW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoQm94ZXMubGVuZ3RoKSk7XG4gICAgdmFyIGZpZ3VyZSA9IEFycmF5LmZyb20oQm94ZXNbaW5kZXhdKTtcbiAgICBHYW1lLnBsYXllci5maWd1cmUgPSBmaWd1cmU7XG5cbiAgICB2YXIgciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoyNTYpO1xuICAgIHZhciBnID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjI1Nik7XG4gICAgdmFyIGIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMjU2KTtcblxuICAgIEdhbWUucGxheWVyLmNvbG9yID0gJ3JnYignK3IrJywnK2crJywnK2IrJyknO1xuXG4gICAgLy8gSmVkZSBLb29yZGluYXRlIGRlciBnZXfDpGhsdGVuIEZpZ3VyIGl0ZXJpZXJlblxuICAgIGZvciAodmFyIGk9MDtpPDQ7aSsrKXtcbiAgICAgICAgLy8gS29vcmRpbmF0ZSBpbSBTcGllbGZlbGQgc2V0emVuXG4gICAgICAgIEZpZWxkLmZpZWxkW3NwYXducG9pbnQueCAtIGZpZ3VyZVtpXS54XVtzcGF3bnBvaW50LnkgLSBmaWd1cmVbaV0ueV0gPSB7XG4gICAgICAgICAgICBzaG93OiB0cnVlLFxuICAgICAgICAgICAgY29sb3I6IEdhbWUucGxheWVyLmNvbG9yXG4gICAgICAgIH07XG4gICAgfSAgXG59O1xuXG5cblxuR2FtZS5tb3ZlUGxheWVyID0gZnVuY3Rpb24oeCx5KXtcbiAgICAvLyBKZWRlIEtvb3JkaW5hdGUgZGVyIGdld8OkaGx0ZW4gRmlndXIgaXRlcmllcmVuXG4gICAgZm9yICh2YXIgaT0wO2k8NDtpKyspe1xuICAgICAgICAvLyBLb29yZGluYXRlIGltIFNwaWVsZmVsZCBzZXR6ZW5cbiAgICAgICAgRmllbGQuZmllbGRbR2FtZS5wbGF5ZXIucG9zaXRpb24ueCAtIEdhbWUucGxheWVyLmZpZ3VyZVtpXS54XVtHYW1lLnBsYXllci5wb3NpdGlvbi55IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLnldID0ge1xuICAgICAgICAgICAgc2hvdzogZmFsc2UsXG4gICAgICAgICAgICBjb2xvcjogXCJncmVlblwiXG4gICAgICAgIH07XG4gICAgfSAgXG4gICAgR2FtZS5wbGF5ZXIucG9zaXRpb24ueSs9eTtcbiAgICBHYW1lLnBsYXllci5wb3NpdGlvbi54Kz14O1xuICAgIC8vIEplZGUgS29vcmRpbmF0ZSBkZXIgZ2V3w6RobHRlbiBGaWd1ciBpdGVyaWVyZW5cbiAgICBmb3IgKHZhciBpPTA7aTw0O2krKyl7XG4gICAgICAgIC8vIEtvb3JkaW5hdGUgaW0gU3BpZWxmZWxkIHNldHplblxuICAgICAgICBGaWVsZC5maWVsZFtHYW1lLnBsYXllci5wb3NpdGlvbi54IC0gR2FtZS5wbGF5ZXIuZmlndXJlW2ldLnhdW0dhbWUucGxheWVyLnBvc2l0aW9uLnkgLSBHYW1lLnBsYXllci5maWd1cmVbaV0ueV0gPSB7XG4gICAgICAgICAgICBzaG93OiB0cnVlLFxuICAgICAgICAgICAgY29sb3I6IEdhbWUucGxheWVyLmNvbG9yXG4gICAgICAgIH07XG4gICAgfSAgXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XG4iLCJ2YXIgR2FtZSA9IHJlcXVpcmUoJy4vR2FtZS5qcycpO1xudmFyIEFwcCA9IHJlcXVpcmUoJy4vQXBwLmpzJyk7XG52YXIgRmllbGQgPSByZXF1aXJlKCcuL0ZpZWxkLmpzJyk7XG5cbkFwcC5pbml0KCk7XG5GaWVsZC5pbml0KCk7XG5cbkdhbWUuc3Bhd24oKTtcblxuR2FtZS5zdGFydCgpOyJdfQ==
